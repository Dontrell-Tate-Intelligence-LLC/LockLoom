<!doctype html>
<meta charset="utf-8" />
<title>LockLoom — Device Owner Provisioning QR</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root { color-scheme: light dark; }
  body { margin:0; font: 16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; display:flex; min-height:100vh; }
  .wrap { margin:auto; max-width: 1100px; padding: 24px; text-align:center; }
  h1 { font-weight: 700; margin: 0 0 8px; }
  .muted { opacity: .75; }
  #qr { display:block; margin: 24px auto; max-width: min(90vmin, 900px); width: 100%; height: auto; }
  .err { color: #c00; font-weight: 600; }
  code, a { word-break: break-all; }

  /* New: policy link banner */
  .policy-banner {
    width: 100%;
    box-sizing: border-box;
    background: color-mix(in oklab, CanvasText 12%, Canvas);
    border-bottom: 1px solid color-mix(in oklab, CanvasText 18%, Canvas);
    padding: 12px 14px;
    text-align: center;
    font-size: 2em;            /* 2× font size only for this section */
    line-height: 1.25;
  }
  .policy-banner a {
    font-weight: 600;
    text-decoration: none;
    display: inline-block;     /* forces the URL onto its own line */
    margin-top: 6px;
  }
  .policy-banner a:hover { text-decoration: underline; }
  .policy-banner img {
    display: block;
    margin: 10px auto 0;
    width: 128px;              /* adjust as desired */
    height: auto;
  }
</style>

<!-- New banner at the very top -->
<div class="policy-banner">
  <div>Device Owner policies &amp; runtime permission disclosure:</div>
  <a
    href="https://dontrell-tate-intelligence-llc.github.io/LockLoom/policies/lockloom-device-owner-policies.html"
    rel="noopener"
    target="_blank"
    title="LockLoom Device Owner Policies & Runtime Permission Disclosure"
  >
    Click Here
  </a>
  <img
    src="https://dontrell-tate-intelligence-llc.github.io/LockLoom/assets/ic_launcher-playstore-512.png"
    alt="LockLoom app icon"
    loading="lazy"
    decoding="async"
  />
</div>

<div class="wrap">
  <h1>LockLoom — Device Owner Provisioning QR</h1>
  <div class="muted">Scannable on Android 9+ setup screen (tap “Welcome” 6–7×)</div>

  <img id="qr" alt="Provisioning QR (latest release)" />

  <div id="status" class="muted">Fetching latest release…</div>

  <p>
    <a id="pngLink" href="#" target="_blank" rel="noopener">Open PNG</a> ·
    <a id="jsonLink" href="#" target="_blank" rel="noopener">Open JSON</a>
  </p>

  <hr/>
  <p class="muted">
  </p>
</div>

<script>
(async () => {
  const owner = "Dontrell-Tate-Intelligence-LLC";
  const repo  = "LockLoom";
  const status = document.getElementById("status");
  const img    = document.getElementById("qr");
  const pngL   = document.getElementById("pngLink");
  const jsonL  = document.getElementById("jsonLink");

  try {
    const resp = await fetch(`https://api.github.com/repos/${owner}/${repo}/releases/latest`, {
      headers: { "Accept": "application/vnd.github+json" },
      cache: "no-store"
    });
    if (!resp.ok) throw new Error(`GitHub API ${resp.status}`);
    const data = await resp.json();

    const png = data.assets.find(a => a.name === "lockloom-device-owner-qr.png");
    const json = data.assets.find(a => a.name === "lockloom-device-owner-qr.json");

    if (!png) throw new Error("lockloom-device-owner-qr.png not found in latest release assets.");

    // browser_download_url works fine as <img src> even though it sets Content-Disposition: attachment
    img.src = png.browser_download_url;
    pngL.href = png.browser_download_url;
    pngL.textContent = "Open PNG";

    if (json) {
      jsonL.href = json.browser_download_url;
      jsonL.textContent = "Open JSON";
    } else {
      jsonL.remove();
    }

    status.textContent = `Loaded from latest release: ${data.tag_name}`;
  } catch (e) {
    status.innerHTML = `<span class="err">Failed to load QR:</span> ${String(e)}`;
  }
})();
</script>
